name: Test link deployment

on:
  workflow_dispatch:
    inputs:
      action:
        description: 'Action for Testing environment'
        required: true
        default: 'update'
        type: choice
        options:
          - update
          - create
          - destroy

env:
  TESTLINK_NAME: ${{ github.ref_name }}

jobs:
  prepare:
    runs-on: self-hosted
    if: github.event.inputs.action == 'update' && contains(github.ref, 'testlink')
    steps:
      - name: Prepare ${{ env.TESTLINK_NAME }} ðŸš—
        run: |
            echo "Actions is ${{ github.event.inputs.action }}"
            echo "Branch is ${{ github.ref_name }}"
  build_frontned:
    runs-on: self-hosted
    if: github.event.inputs.action == 'update' && contains(github.ref, 'testlink')
    needs: [prepare]
    steps:
      - name: Build FrontEnd ${{ env.TESTLINK_NAME }} ðŸš—
        run: |
            echo "Actions is ${{ github.event.inputs.action }}"
  build_containers:
    runs-on: self-hosted
    if: github.event.inputs.action == 'update' && contains(github.ref, 'testlink')
    needs: [prepare]
    steps:
      - name: Build Containers ${{ env.TESTLINK_NAME }} ðŸš—
        run: |
            echo "Actions is ${{ github.event.inputs.action }}"
  deploy:
    runs-on: self-hosted
    if: github.event.inputs.action == 'update' && contains(github.ref, 'testlink')
    needs: [build_frontned, build_containers]
    steps:
      - name: Deploy ${{ env.TESTLINK_NAME }} ðŸš—
        run: |
            echo "Actions is ${{ github.event.inputs.action }}"
  create:
    runs-on: self-hosted
    if: github.event.inputs.action == 'create' && contains(github.ref, 'testlink')
    steps:
      - name: Create ${{ env.TESTLINK_NAME }} ðŸš—
        run: |
            echo "Actions is ${{ github.event.inputs.action }}"
            byobu-screen -S test -d -m ping -c 100 8.8.8.8
  destroy:
    runs-on: self-hosted
    if: github.event.inputs.action == 'destroy' && contains(github.ref, 'testlink')
    steps:
      - name: Destroy ${{ env.TESTLINK_NAME }} ðŸš—
        run: |
            echo "Actions is ${{ github.event.inputs.action }}"